<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ë–ª–µ–∫–∞—É—Ç-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä 10.0 (Final Cut)</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-app: #f2f2f7;
            --card-bg: #ffffff;
            --text-main: #111827;
            --radius: 24px; /* –©–µ –±—ñ–ª—å—à–µ —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—è */
            
            /* === –ö–û–õ–¨–û–†–ò === */
            --chart-bg: #ffffff;
            
            /* –°–≤—ñ—Ç–ª–æ –Ñ (ON) */
            --tile-bg-on: #f3f4f6;
            --text-on: #111827;     /* –¢–µ–º–Ω–∏–π —Ç–µ–∫—Å—Ç */
            --border-on: #eab308;   /* –ñ–æ–≤—Ç–∞ —Ä–∞–º–∫–∞ */
            
            /* –°–≤—ñ—Ç–ª–∞ –ù–ï–ú–ê (OFF) */
            --tile-bg-off: #000000; /* Digital Black */
            --text-off: #ffffff;    /* –ë—ñ–ª–∏–π —Ç–µ–∫—Å—Ç */
            
            /* –Ü–∫–æ–Ω–∫–∏ (—Ç–µ–ø–µ—Ä —É—Å–ø–∞–¥–∫–æ–≤—É—é—Ç—å –∫–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É, —â–æ–± –±—É—Ç–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–º–∏) */
            --icon-size: 20px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .app-container {
            width: 100%;
            max-width: 540px; /* –©–µ —à–∏—Ä—à–µ –¥–ª—è –∫—Ä–∞—Å–∏ */
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        textarea {
            width: 100%;
            height: 80px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 10px;
            font-family: monospace;
            background: #f9fafb;
            color: var(--text-main);
            box-sizing: border-box;
            resize: none;
        }

        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 14px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-primary { background: #007aff; color: white; }
        .btn-secondary { background: #e5e7eb; color: var(--text-main); }

        /* === –ó–û–ù–ê –ì–ï–ù–ï–†–ê–¶–Ü–á === */
        #captureTarget {
            background-color: var(--chart-bg);
            padding: 40px; /* –ë—ñ–ª—å—à–µ –ø–æ–≤—ñ—Ç—Ä—è –Ω–∞–≤–∫–æ–ª–æ */
            border-radius: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            position: absolute; 
            left: -9999px; top: 0; /* –•–æ–≤–∞—î–º–æ –∑ –µ–∫—Ä–∞–Ω—É */
            width: 600px; /* –§—ñ–∫—Å–æ–≤–∞–Ω–∞ —à–∏—Ä–∏–Ω–∞ –¥–ª—è –≤–∏—Å–æ–∫–æ—ó —è–∫–æ—Å—Ç—ñ */
            box-sizing: border-box;
        }

        .header-row {
            display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 35px;
        }
        .header-title { font-size: 28px; font-weight: 900; text-transform: uppercase; line-height: 1.1; letter-spacing: -0.5px;}
        .header-subtitle { font-size: 15px; color: #6b7280; font-weight: 500; margin-top: 6px; }
        .logo-fixed { height: 55px; width: auto; object-fit: contain; }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px; /* –ë—ñ–ª—å—à—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ –º—ñ–∂ –ø–ª–∏—Ç–∫–∞–º–∏ */
        }

        /* === –ü–õ–ò–¢–ö–ê (–ì–µ–Ω—ñ–π —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó) === */
        .hour-box {
            position: relative;
            aspect-ratio: 1.8/1; /* –®–∏—Ä–æ–∫—ñ, –∫—Ä–∞—Å–∏–≤—ñ */
            border-radius: var(--radius);
            font-weight: 700;
            font-size: 24px; /* –í–µ–ª–∏–∫–∏–π —à—Ä–∏—Ñ—Ç */
            cursor: pointer;
            overflow: hidden; /* –û–±—Ä—ñ–∑–∞—î–º–æ –≤—Å–µ –∑–∞–π–≤–µ */
            /* border: –∑–∞–¥–∞—î—Ç—å—Å—è —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ */
            box-sizing: border-box; 
        }

        /* 1. –®–ê–† –§–û–ù–£ (Background Layer) */
        .bg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
        }

        /* 2. –®–ê–†–ò –ö–û–ù–¢–ï–ù–¢–£ (Content Layers) 
           –ú–∏ –¥—É–±–ª—é—î–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç (–Ü–∫–æ–Ω–∫–∞ + –¢–µ–∫—Å—Ç) –¥–≤—ñ—á—ñ.
           –û–¥–∏–Ω —à–∞—Ä –ø–æ–∫–∞–∑—É—î –ª—ñ–≤—É —á–∞—Å—Ç–∏–Ω—É, —ñ–Ω—à–∏–π - –ø—Ä–∞–≤—É.
           –¶–µ –¥–æ–∑–≤–æ–ª—è—î —ñ–∫–æ–Ω—Ü—ñ —Ç–µ–∂ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –∫–æ–ª—ñ—Ä –Ω–∞–ø–æ–ª–æ–≤–∏–Ω—É! */
        
        .content-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; 
            align-items: center; 
            justify-content: center;
            gap: 8px; /* –í—ñ–¥—Å—Ç—É–ø –º—ñ–∂ —ñ–∫–æ–Ω–∫–æ—é —ñ —Ü–∏—Ñ—Ä–æ—é */
            z-index: 2;
        }
        
        /* –õ—ñ–≤–∞ –ø–æ–ª–æ–≤–∏–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç—É (0-50%) */
        .layer-left { clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%); }
        
        /* –ü—Ä–∞–≤–∞ –ø–æ–ª–æ–≤–∏–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç—É (50-100%) */
        .layer-right { clip-path: polygon(50% 0, 100% 0, 100% 100%, 50% 100%); }

        /* –°—Ç–∏–ª—å —ñ–∫–æ–Ω–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —à–∞—Ä—É */
        .status-icon {
            width: 22px; height: 22px;
            display: block;
        }

        /* === –õ–û–ì–Ü–ö–ê –°–¢–ê–ù–Ü–í === */

        /* A. –°–í–Ü–¢–õ–û –Ñ (ON) */
        .status-on { border: 2px solid var(--border-on); } /* –ñ–æ–≤—Ç–∞ —Ä–∞–º–∫–∞ */
        .status-on .bg-layer { background-color: var(--tile-bg-on); }
        .status-on .content-layer { color: var(--text-on); } /* –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç —Ç–µ–º–Ω–∏–π */

        /* B. –°–í–Ü–¢–õ–ê –ù–ï–ú–ê (OFF) */
        .status-off { border: 2px solid transparent; }
        .status-off .bg-layer { background-color: var(--tile-bg-off); }
        .status-off .content-layer { color: var(--text-off); } /* –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç –±—ñ–ª–∏–π */

        /* C. –í–ò–ú–ò–ö–ê–Æ–¢–¨ (Start Half: Light -> Dark) */
        .status-start-half { border: 2px solid transparent; } /* –ë–µ–∑ —Ä–∞–º–∫–∏, –±–æ —Å–∫–ª–∞–¥–Ω–æ –∑ –≥—Ä–∞–¥—ñ—î–Ω—Ç–æ–º */
        .status-start-half .bg-layer { 
            background: linear-gradient(90deg, var(--tile-bg-on) 50%, var(--tile-bg-off) 50%);
        }
        /* –õ—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ —Ñ–æ–Ω—É –°–í–Ü–¢–õ–ê -> —Ç–µ–∫—Å—Ç –¢–ï–ú–ù–ò–ô */
        .status-start-half .layer-left { color: var(--text-on); }
        /* –ü—Ä–∞–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ —Ñ–æ–Ω—É –¢–ï–ú–ù–ê -> —Ç–µ–∫—Å—Ç –ë–Ü–õ–ò–ô */
        .status-start-half .layer-right { color: var(--text-off); }

        /* D. –í–ú–ò–ö–ê–Æ–¢–¨ (End Half: Dark -> Light) */
        .status-end-half { border: 2px solid transparent; }
        .status-end-half .bg-layer { 
            background: linear-gradient(90deg, var(--tile-bg-off) 50%, var(--tile-bg-on) 50%);
        }
        /* –õ—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ —Ñ–æ–Ω—É –¢–ï–ú–ù–ê -> —Ç–µ–∫—Å—Ç –ë–Ü–õ–ò–ô */
        .status-end-half .layer-left { color: var(--text-off); }
        /* –ü—Ä–∞–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ —Ñ–æ–Ω—É –°–í–Ü–¢–õ–ê -> —Ç–µ–∫—Å—Ç –¢–ï–ú–ù–ò–ô */
        .status-end-half .layer-right { color: var(--text-on); }


        /* –ë–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É */
        #outputContainer {
            display: none; background: var(--card-bg); padding: 20px;
            border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center;
        }
        #generatedImage { width: 100%; height: auto; border-radius: 12px; display: block; }
        .output-hint { font-size: 14px; font-weight: 600; color: #6b7280; margin-top: 15px; margin-bottom: 5px;}
        .copy-area { display: none; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="card">
            <h2 style="margin:0 0 15px 0; color:var(--text-main);">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä 10.0 (Perfect)</h2>
            <textarea id="rawText" placeholder="–í—Å—Ç–∞–≤ —Å—é–¥–∏ —Ç–µ–∫—Å—Ç –≥—Ä–∞—Ñ—ñ–∫—É..."></textarea>
            <div class="btn-group">
                <button class="btn-primary" onclick="processDataAndGenerate()">‚ö° –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Å—Ç</button>
                <button class="btn-secondary" onclick="clearAll()">‚ùå –°–∫–∏–Ω—É—Ç–∏</button>
            </div>
            <div id="debug" style="color:red; font-size:12px; margin-top:5px; text-align:center;"></div>
        </div>

        <div id="captureTarget">
            <div class="header-row">
                <div>
                    <div class="header-title" id="dateDisplay">–ì–†–ê–§–Ü–ö<br>–í–Ü–î–ö–õ–Æ–ß–ï–ù–¨</div>
                    <div class="header-subtitle">–ó–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –•–∞—Ä–∫—ñ–≤–æ–±–ª–µ–Ω–µ—Ä–≥–æ</div>
                </div>
                <img src="./logo.png" alt="Logo" class="logo-fixed" onerror="this.style.display='none'">
            </div>
            <div class="grid-container" id="grid"></div>
        </div>

        <div id="outputContainer">
            <img id="generatedImage" src="">
            <p class="output-hint">‚òùÔ∏è –ó–∞—Ç–∏—Å–Ω–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É, —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏</p>
        </div>

        <div class="card copy-area" id="copyCard">
            <textarea id="resultText" style="height:120px;" readonly></textarea>
            <button class="btn-secondary" style="width:100%; margin-top:10px;" onclick="copyText()">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç</button>
        </div>
    </div>

    <script>
        const grid = document.getElementById('grid');
        const debug = document.getElementById('debug');
        const dateDisplay = document.getElementById('dateDisplay');
        const resultTextArea = document.getElementById('resultText');
        const copyCard = document.getElementById('copyCard');
        const captureTarget = document.getElementById('captureTarget');
        const outputContainer = document.getElementById('outputContainer');
        const generatedImage = document.getElementById('generatedImage');
        
        let hoursStatus = new Array(24).fill('on'); 
        const clocks = ['üïõ', 'üïê', 'üïë', 'üïí', 'üïì', 'üïî', 'üïï', 'üïñ', 'üïó', 'üïò', 'üïô', 'üïö'];

        // –Ü–∫–æ–Ω–∫–∞ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ currentColor, —â–æ–± –∫–æ–ª—ñ—Ä –∑–º—ñ–Ω—é–≤–∞–≤—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
        // –¶–µ —Ç–∞ —Å–∞–º–∞ —ñ–∫–æ–Ω–∫–∞, –∞–ª–µ fill/stroke –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫–æ–ª—å–æ—Ä—É —Ç–µ–∫—Å—Ç—É –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –±–ª–æ–∫—É
        const iconSvg = `<svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14H12L11 22L21 10H12L13 2Z"/></svg>`;
        
        // –î–ª—è OFF –º–æ–∂–Ω–∞ —ñ–Ω—à—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –ø–µ—Ä–µ–∫—Ä–µ—Å–ª–µ–Ω—É, –∞–ª–µ —Ç–∏ –ø—Ä–æ—Å–∏–≤ –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å. 
        // –ù–∞–π—Å—Ç–∏–ª—å–Ω—ñ—à–µ - –ø—Ä–æ—Å—Ç–æ –±–ª–∏—Å–∫–∞–≤–∫–∞, —è–∫–∞ —Å—Ç–∞—î –±—ñ–ª–æ—é –Ω–∞ —á–æ—Ä–Ω–æ–º—É.
        // –Ø–∫—â–æ —Ö–æ—á–µ—à —Ä—ñ–∑–Ω—ñ —ñ–∫–æ–Ω–∫–∏, —Å–∫–∞–∂–∏. –ü–æ–∫–∏ –∑–∞–ª–∏—à–∏–≤ –æ–¥–Ω—É —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—É –±–ª–∏—Å–∫–∞–≤–∫—É.

        function initGrid() {
            grid.innerHTML = '';
            for (let i = 0; i < 24; i++) {
                const div = document.createElement('div');
                div.className = 'hour-box'; // –±–∞–∑–æ–≤–∏–π –∫–ª–∞—Å
                const timeStr = i.toString().padStart(2, '0') + ":00";
                
                // –°–¢–†–£–ö–¢–£–†–ê:
                // 1. –§–æ–Ω
                // 2. –õ—ñ–≤–∏–π —à–∞—Ä (–Ü–∫–æ–Ω–∫–∞ + –¢–µ–∫—Å—Ç) - –æ–±—Ä—ñ–∑–∞–Ω–∏–π
                // 3. –ü—Ä–∞–≤–∏–π —à–∞—Ä (–Ü–∫–æ–Ω–∫–∞ + –¢–µ–∫—Å—Ç) - –æ–±—Ä—ñ–∑–∞–Ω–∏–π
                
                const contentHtml = `${iconSvg} <span>${timeStr}</span>`;

                div.innerHTML = `
                    <div class="bg-layer"></div>
                    <div class="content-layer layer-left">${contentHtml}</div>
                    <div class="content-layer layer-right">${contentHtml}</div>
                `;
                grid.appendChild(div);
            }
            renderAll();
        }

        function renderSingle(idx) {
            const div = grid.children[idx];
            const status = hoursStatus[idx];
            // –ü—Ä–æ—Å—Ç–æ –º—ñ–Ω—è—î–º–æ –∫–ª–∞—Å, CSS –∑—Ä–æ–±–∏—Ç—å –≤—Å—é –º–∞–≥—ñ—é –∑ –∫–æ–ª—å–æ—Ä–∞–º–∏
            div.className = 'hour-box status-' + status;
        }

        function renderAll() { for(let i=0; i<24; i++) renderSingle(i); }

        function processDataAndGenerate() {
            const text = document.getElementById('rawText').value;
            debug.textContent = "";
            
            const dateRegex = /(\d{1,2})\s+(—Å—ñ—á–Ω—è|–ª—é—Ç–æ–≥–æ|–±–µ—Ä–µ–∑–Ω—è|–∫–≤—ñ—Ç–Ω—è|—Ç—Ä–∞–≤–Ω—è|—á–µ—Ä–≤–Ω—è|–ª–∏–ø–Ω—è|—Å–µ—Ä–ø–Ω—è|–≤–µ—Ä–µ—Å–Ω—è|–∂–æ–≤—Ç–Ω—è|–ª–∏—Å—Ç–æ–ø–∞–¥–∞|–≥—Ä—É–¥–Ω—è)/i;
            const dateMatch = text.match(dateRegex);
            let dateStr = "–°–¨–û–ì–û–î–ù–Ü";
            if (dateMatch) dateStr = dateMatch[0].toUpperCase();
            dateDisplay.innerHTML = `–ì–†–ê–§–Ü–ö<br>–ù–ê ${dateStr}`;

            const regex = /(?:^|\n)\s*1\.2\s+([^\n]+)/;
            const match = text.match(regex);
            if (!match) { debug.textContent = "–ù–µ –±–∞—á—É 1.2!"; return; }

            hoursStatus.fill('on');
            let textIntervals = [];
            const ranges = match[1].trim().split(';');

            ranges.forEach(range => {
                range = range.trim();
                if (!range || !/\d/.test(range)) return;
                const parts = range.split(/[\-\‚Äì\‚Äî]/); 
                if (parts.length < 2) return;
                const startStr = parts[0].trim(); const endStr = parts[1].trim();
                applyRange(parseTime(startStr), parseTime(endStr));
                textIntervals.push(`${getClockEmoji(startStr)} ${startStr}-${endStr}`);
            });

            renderAll();
            resultTextArea.value = `‚ö°Ô∏èüí° –ì–†–ê–§–Ü–ö –í–Ü–î–ö–õ–Æ–ß–ï–ù–¨ –ù–ê ${dateStr}\n\n${textIntervals.join('\n')}\n\n–•–∞—Ä–∫—ñ–≤–æ–±–ª–µ–Ω–µ—Ä–≥–æ`;
            
            // –ó–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ —Å–∫—Ä—ñ–Ω–æ–º, —â–æ–± —à—Ä–∏—Ñ—Ç–∏ —ñ —Å—Ç–∏–ª—ñ —Ç–æ—á–Ω–æ –ø—Ä–æ–≤–∞–Ω—Ç–∞–∂–∏–ª–∏—Å—å
            setTimeout(generateImageOutput, 100);
            copyCard.style.display = 'block';
        }

        function parseTime(t) { const [h, m] = t.replace(/[^\d:]/g, '').split(':').map(Number); return { h: h, m: m || 0 }; }
        function getClockEmoji(t) { let h = parseInt(t.split(':')[0]); return isNaN(h) ? 'üïí' : clocks[h % 12]; }
        
        function applyRange(start, end) {
            let s = start.h * 60 + start.m; let e = end.h * 60 + end.m;
            if (e === 0 && end.h === 0) e = 1440; if (e < s) e = 1440; 
            for (let h = 0; h < 24; h++) {
                let hs = h * 60; let he = (h + 1) * 60;
                if (hs >= s && he <= e) hoursStatus[h] = 'off';
                else if (s > hs && s < he) hoursStatus[h] = start.m >= 30 ? 'start-half' : 'off';
                else if (e > hs && e < he) hoursStatus[h] = end.m >= 30 ? 'end-half' : 'on';
            }
        }

        function clearAll() {
            document.getElementById('rawText').value = '';
            hoursStatus.fill('on');
            renderAll();
            copyCard.style.display = 'none';
            outputContainer.style.display = 'none';
            dateDisplay.innerHTML = '–ì–†–ê–§–Ü–ö<br>–í–Ü–î–ö–õ–Æ–ß–ï–ù–¨';
        }

        function copyText() {
            const el = document.getElementById("resultText"); el.select(); el.setSelectionRange(0, 99999); navigator.clipboard.writeText(el.value);
        }

        function generateImageOutput() {
            html2canvas(captureTarget, {
                scale: 2, 
                backgroundColor: "#ffffff",
                logging: false,
                useCORS: true
            }).then(canvas => {
                generatedImage.src = canvas.toDataURL('image/png');
                outputContainer.style.display = 'block';
            });
        }

        initGrid();
    </script>
</body>
</html>

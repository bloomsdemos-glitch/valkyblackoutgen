<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ë–ª–µ–∫–∞—É—Ç-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä 14.0</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-app: #f2f2f7;
            --card-bg: #ffffff;
            --text-main: #000000;
            --radius: 20px;
            --btn-blue: #007aff;
            --btn-gray: #e5e7eb;

            /* === –ó–ú–Ü–ù–ù–Ü –¢–ï–ú–ò (Default) === */
            --chart-bg: #ffffff;
            --light-bg: #fbbf24;   /* –ñ–æ–≤—Ç–∏–π */
            --light-text: #1f2937; /* –¢–µ–º–Ω–∏–π —Ç–µ–∫—Å—Ç */
            --dark-bg: #1f2937;    /* –ì—Ä–∞—Ñ—ñ—Ç */
            --dark-text: #ffffff;  /* –ë—ñ–ª–∏–π —Ç–µ–∫—Å—Ç */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .app-container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        h2 { margin: 0 0 15px 0; font-size: 20px; }

        /* INPUTS */
        textarea {
            width: 100%;
            height: 80px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 10px;
            font-family: monospace;
            background: #f9fafb;
            color: var(--text-main);
            box-sizing: border-box;
            resize: none;
            font-size: 14px;
        }

        select {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
            font-size: 14px;
            font-weight: 600;
            appearance: none; /* iOS fix */
            color: var(--text-main);
        }

        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        button {
            flex: 1; padding: 14px; border: none; border-radius: 12px;
            font-weight: 700; font-size: 15px; cursor: pointer; transition: 0.2s;
            display: flex; justify-content: center; align-items: center; gap: 5px;
        }
        button:active { transform: scale(0.97); }
        .btn-primary { background: var(--btn-blue); color: white; }
        .btn-secondary { background: var(--btn-gray); color: var(--text-main); }
        .btn-theme { background: #8e8e93; color: white; flex: 0 0 50px; } /* –ö–Ω–æ–ø–∫–∞ —Ç–µ–º–∏ */

        /* === –ó–û–ù–ê –ì–ï–ù–ï–†–ê–¶–Ü–á === */
        #captureTarget {
            background-color: var(--chart-bg);
            padding: 35px;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            position: absolute; 
            left: -9999px; 
            top: 0; 
            width: 540px; 
            box-sizing: border-box;
        }

        .header-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; }
        .header-title { font-size: 26px; font-weight: 900; text-transform: uppercase; line-height: 1.1; color: var(--light-text); }
        .header-subtitle { font-size: 14px; color: #6b7280; font-weight: 500; margin-top: 6px; }
        .logo-fixed { height: 55px; width: auto; object-fit: contain; }

        .grid-container {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 25px;
        }

        /* –ü–ª–∏—Ç–∫–∞ */
        .hour-box {
            position: relative;
            aspect-ratio: 1.5/1;
            border-radius: 18px;
            overflow: hidden; 
            font-weight: 700;
            font-size: 22px;
            background-color: var(--light-bg); 
        }

        /* –®–∞—Ä–∏ */
        .layer-base {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            gap: 8px;
            background-color: var(--light-bg);
            color: var(--light-text);
            z-index: 1;
        }

        .layer-overlay {
            position: absolute; top: 0; height: 100%;
            overflow: hidden; z-index: 2;
            background-color: var(--dark-bg);
            color: var(--dark-text);
            width: 0; display: none; 
        }

        .overlay-content {
            position: absolute; top: 0; height: 100%; width: 100%; 
            display: flex; align-items: center; justify-content: center;
            gap: 8px; white-space: nowrap;
        }

        /* –Ü–∫–æ–Ω–∫–∏ –∑ currentColor */
        .icon-svg { width: 22px; height: 22px; display: block; flex-shrink: 0; stroke: currentColor; }
        .time-text { display: block; white-space: nowrap; line-height: 1; margin-top: 2px; }

        /* –§—É—Ç–µ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏ */
        .footer-info {
            display: flex; align-items: center; gap: 8px;
            margin-top: 8px; padding-top: 18px;
            border-top: 1px solid #e5e7eb;
            color: #6b7280;
        }
        .info-icon { width: 20px; height: 20px; flex-shrink: 0; stroke: #6b7280; }
        .footer-text { font-size: 13px; font-weight: 500; line-height: 1.3; }

        /* === –ë–õ–û–ö –†–ï–ó–£–õ–¨–¢–ê–¢–£ === */
        #outputContainer { display: none; animation: fadeIn 0.3s ease; }
        
        .result-image-wrapper {
            position: relative;
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        #generatedImage { width: 100%; height: auto; display: block; }

        .btn-download {
            background: #34c759; color: white; width: 100%; margin-bottom: 20px;
        }

        /* ONE-TAP COPY BLOCK */
        .copy-block {
            background: #f1f5f9;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 15px;
            text-align: left;
            cursor: pointer;
            transition: 0.2s all;
            position: relative;
        }
        .copy-block:active { transform: scale(0.98); background: #e2e8f0; }
        .copy-block.copied { background: #dcfce7; border-color: #22c55e; }
        
        .copy-content {
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            color: #334155;
            pointer-events: none; /* —â–æ–± –∫–ª—ñ–∫ –ø—Ä–æ—Ö–æ–¥–∏–≤ –∫—Ä—ñ–∑—å —Ç–µ–∫—Å—Ç */
        }
        
        .copy-hint {
            position: absolute;
            top: -10px; right: 10px;
            background: #22c55e; color: white;
            font-size: 10px; font-weight: 700;
            padding: 4px 8px; border-radius: 10px;
            opacity: 0; transition: 0.2s;
        }
        .copy-block.copied .copy-hint { opacity: 1; top: -12px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div class="app-container">
        
        <div class="card">
            <h2>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
            
            <label style="font-size:12px; font-weight:700; color:#6b7280; text-transform:uppercase;">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
            <select id="titleSelect">
                <option value="‚ö°Ô∏èüí° –ì–†–ê–§–Ü–ö –í–Ü–î–ö–õ–Æ–ß–ï–ù–¨">‚ö°Ô∏è –ö–ª–∞—Å–∏—á–Ω–∏–π: –ì–†–ê–§–Ü–ö –í–Ü–î–ö–õ–Æ–ß–ï–ù–¨</option>
                <option value="üé≤ –ì–ï–ù–ï–†–ê–¢–û–† –í–ò–ü–ê–î–ö–û–í–ò–• –ß–ò–°–ï–õ">üé≤ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö —á–∏—Å–µ–ª</option>
                <option value="üé° –ö–û–õ–ï–°–û –§–û–†–¢–£–ù–ò">üé° –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω–∏</option>
                <option value="üõ∏ –ù–ê–£–ö–û–í–û-–§–ê–ù–¢–ê–°–¢–ò–ß–ù–ò–ô –ì–†–ê–§–Ü–ö">üõ∏ –ù–∞—É–∫–æ–≤–æ-—Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫</option>
                <option value="üîÆ –•–í–ò–õ–ò–ù–ö–ê –ì–ê–ó–õ–ê–ô–¢–ò–ù–ì–£">üîÆ –•–≤–∏–ª–∏–Ω–∫–∞ –≥–∞–∑–ª–∞–π—Ç–∏–Ω–≥—É</option>
                <option value="üåå –ì–†–ê–§–Ü–ö –ó –ü–ê–†–ê–õ–ï–õ–¨–ù–û–ì–û –í–°–ï–°–í–Ü–¢–£">üåå –ì—Ä–∞—Ñ—ñ–∫ –∑ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ –≤—Å–µ—Å–≤—ñ—Ç—É</option>
                <option value="ü§° –ö–ê–†–¢–ò–ù–ö–ê –ó–ê –ó–í–ò–ß–ö–û–Æ">ü§° –ö–∞—Ä—Ç–∏–Ω–∫–∞, —è–∫—É –º–∏ –ø–æ—Å—Ç–∏–º–æ –∑–∞ –∑–≤–∏—á–∫–æ—é</option>
                <option value="üíî –ì–†–ê–§–Ü–ö (–ù–ï –ë–ï–†–Ü–¢–¨ –ë–õ–ò–ó–¨–ö–û –î–û –°–ï–†–¶–Ø)">üíî –ì—Ä–∞—Ñ—ñ–∫ (–Ω–µ –±–µ—Ä—ñ—Ç—å –±–ª–∏–∑—å–∫–æ –¥–æ —Å–µ—Ä—Ü—è)</option>
                <option value="üßü‚Äç‚ôÇÔ∏è –ì–†–ê–§–Ü–ö –í–ò–ñ–ò–í–ê–ù–ù–Ø">üßü‚Äç‚ôÇÔ∏è –ì—Ä–∞—Ñ—ñ–∫ –≤–∏–∂–∏–≤–∞–Ω–Ω—è</option>
                <option value="üé∞ –õ–û–¢–ï–†–ï–Ø –í–Ü–î –û–ë–õ–ï–ù–ï–†–ì–û">üé∞ –õ–æ—Ç–µ—Ä–µ—è –≤—ñ–¥ –û–±–ª–µ–Ω–µ—Ä–≥–æ</option>
            </select>

            <textarea id="rawText" placeholder="–í—Å—Ç–∞–≤ —Ç–µ–∫—Å—Ç –≥—Ä–∞—Ñ—ñ–∫—É (–¥–µ —î 1.2 —ñ —á–∞—Å)..."></textarea>
            
            <div class="btn-group">
                <button class="btn-primary" onclick="processDataAndGenerate()">‚ö° –°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                <button class="btn-theme" onclick="changeTheme()" title="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">üé®</button>
                <button class="btn-secondary" style="flex:0 0 50px;" onclick="clearAll()">‚ùå</button>
            </div>
            <div id="debug" style="color:red; font-size:12px; margin-top:5px; text-align:center;"></div>
        </div>

        <div id="captureTarget">
            <div class="header-row">
                <div>
                    <div class="header-title" id="dateDisplay">–ì–†–ê–§–Ü–ö<br>–í–Ü–î–ö–õ–Æ–ß–ï–ù–¨</div>
                    <div class="header-subtitle">–ó–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –•–∞—Ä–∫—ñ–≤–æ–±–ª–µ–Ω–µ—Ä–≥–æ</div>
                </div>
                <img src="./logo.png" alt="Logo" class="logo-fixed" onerror="this.style.display='none'">
            </div>
            
            <div class="grid-container" id="grid"></div>

            <div class="footer-info">
                <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                <div class="footer-text">–ü—ñ–¥ —á–∞—Å –∞–≤–∞—Ä—ñ–π–Ω–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –≥—Ä–∞—Ñ—ñ–∫ –Ω–µ –¥—ñ—î</div>
            </div>
        </div>

        <div id="outputContainer" class="card">
            
            <div class="result-image-wrapper">
                <img id="generatedImage" src="">
            </div>
            
            <button class="btn-download" onclick="downloadImage()">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É</button>

            <label style="font-size:12px; font-weight:700; color:#6b7280; text-transform:uppercase; margin-bottom:5px; display:block;">–¢–µ–∫—Å—Ç –¥–ª—è –ø–æ—Å—Ç—É (–ù–∞—Ç–∏—Å–Ω–∏ —â–æ–± —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏)</label>
            <div class="copy-block" id="copyBlock" onclick="copyTextToClipboard()">
                <div class="copy-hint">–°–ö–û–ü–Ü–ô–û–í–ê–ù–û!</div>
                <div class="copy-content" id="finalTextDisplay">–¢—É—Ç –±—É–¥–µ —Ç–µ–∫—Å—Ç...</div>
            </div>

        </div>
    </div>

    <script>
        // === –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –¢–ï–ú ===
        const themes = [
            { name: "Default", bg: "#ffffff", lBg: "#fbbf24", lTx: "#1f2937", dBg: "#1f2937", dTx: "#ffffff" },
            { name: "High Contrast", bg: "#ffffff", lBg: "#e5e5e5", lTx: "#000000", dBg: "#000000", dTx: "#ffffff" }, // –ß–æ—Ä–Ω–æ-–±—ñ–ª–∞
            { name: "Mint", bg: "#f0fdf4", lBg: "#86efac", lTx: "#064e3b", dBg: "#1e293b", dTx: "#f0fdf4" }, // –ú'—è—Ç–Ω–∞
            { name: "Cyber", bg: "#0f172a", lBg: "#22d3ee", lTx: "#000000", dBg: "#000000", dTx: "#22d3ee" }, // –ö—ñ–±–µ—Ä
            { name: "Alert", bg: "#fff1f2", lBg: "#fecdd3", lTx: "#881337", dBg: "#881337", dTx: "#ffffff" }  // –ß–µ—Ä–≤–æ–Ω–∞
        ];
        let currentThemeIndex = 0;

        // –Ü–ö–û–ù–ö–ò (stroke: currentColor - —â–æ–± –º—ñ–Ω—è–ª–∏ –∫–æ–ª—ñ—Ä –≤—ñ–¥ —Ç–µ–º–∏)
        const iconBulb = `<svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1.2 1.5-2.5 1.5-4a6 6 0 0 0-6-6 6 6 0 0 0-6 6c0 1.4.5 2.7 1.5 4 .7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`;
        const iconZapOff = `<svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><polyline points="12.41 6.75 13 2 10.57 4.92"/><polyline points="18.57 12.91 21 10 15.66 10"/><polyline points="8 8 3 14 12 14 11 22 16 16"/><line x1="2" y1="2" x2="22" y2="22"/></svg>`;

        const grid = document.getElementById('grid');
        const debug = document.getElementById('debug');
        const dateDisplay = document.getElementById('dateDisplay');
        const finalTextDisplay = document.getElementById('finalTextDisplay');
        const copyBlock = document.getElementById('copyBlock');
        const captureTarget = document.getElementById('captureTarget');
        const outputContainer = document.getElementById('outputContainer');
        const generatedImage = document.getElementById('generatedImage');
        const titleSelect = document.getElementById('titleSelect');
        
        let hoursStatus = new Array(24).fill('on'); 
        const clocks = ['üïõ', 'üïê', 'üïë', 'üïí', 'üïì', 'üïî', 'üïï', 'üïñ', 'üïó', 'üïò', 'üïô', 'üïö'];
        let finalGeneratedText = ""; // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è

        // === –§–£–ù–ö–¶–Ü–á –¢–ï–ú ===
        function changeTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            applyTheme(themes[currentThemeIndex]);
        }

        function applyTheme(t) {
            const r = document.documentElement.style;
            r.setProperty('--chart-bg', t.bg);
            r.setProperty('--light-bg', t.lBg);
            r.setProperty('--light-text', t.lTx);
            r.setProperty('--dark-bg', t.dBg);
            r.setProperty('--dark-text', t.dTx);
        }

        // === –ì–ï–ù–ï–†–ê–¶–Ü–Ø ===
        function initGrid() {
            grid.innerHTML = '';
            for (let i = 0; i < 24; i++) {
                const div = document.createElement('div');
                div.className = 'hour-box';
                const timeStr = i.toString().padStart(2, '0') + ":00";
                
                const layerBase = document.createElement('div');
                layerBase.className = 'layer-base';
                layerBase.innerHTML = `${iconBulb}<span class="time-text">${timeStr}</span>`;
                
                const layerOverlay = document.createElement('div');
                layerOverlay.className = 'layer-overlay';
                
                const overlayContent = document.createElement('div');
                overlayContent.className = 'overlay-content';
                overlayContent.innerHTML = `${iconZapOff}<span class="time-text">${timeStr}</span>`;
                
                layerOverlay.appendChild(overlayContent);
                div.appendChild(layerBase);
                div.appendChild(layerOverlay);
                grid.appendChild(div);
            }
            renderAll();
        }

        function renderSingle(idx) {
            const div = grid.children[idx];
            const status = hoursStatus[idx];
            const overlay = div.querySelector('.layer-overlay');
            const overlayContent = div.querySelector('.overlay-content');
            
            overlay.style.display = 'none';
            overlay.style.left = 'auto';
            overlay.style.right = 'auto';
            overlayContent.style.left = 'auto';
            overlayContent.style.right = 'auto';

            const boxWidth = div.offsetWidth + 'px';
            overlayContent.style.width = boxWidth;

            if (status === 'on') {
                overlay.style.display = 'none';
            } 
            else if (status === 'off') {
                overlay.style.display = 'block';
                overlay.style.width = '100%';
                overlay.style.left = '0';
                overlayContent.style.left = '0';
            }
            else if (status === 'start-half') {
                overlay.style.display = 'block';
                overlay.style.width = '50.5%'; 
                overlay.style.right = '0';
                overlayContent.style.right = '0';
            }
            else if (status === 'end-half') {
                overlay.style.display = 'block';
                overlay.style.width = '50.5%';
                overlay.style.left = '0';
                overlayContent.style.left = '0';
            }
        }

        function renderAll() { 
            setTimeout(() => { for(let i=0; i<24; i++) renderSingle(i); }, 0);
        }

        function processDataAndGenerate() {
            const text = document.getElementById('rawText').value;
            const selectedTitle = titleSelect.value; // –ë–µ—Ä–µ–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫
            debug.textContent = "";
            
            // –î–∞—Ç–∞
            const dateRegex = /(\d{1,2})\s+(—Å—ñ—á–Ω—è|–ª—é—Ç–æ–≥–æ|–±–µ—Ä–µ–∑–Ω—è|–∫–≤—ñ—Ç–Ω—è|—Ç—Ä–∞–≤–Ω—è|—á–µ—Ä–≤–Ω—è|–ª–∏–ø–Ω—è|—Å–µ—Ä–ø–Ω—è|–≤–µ—Ä–µ—Å–Ω—è|–∂–æ–≤—Ç–Ω—è|–ª–∏—Å—Ç–æ–ø–∞–¥–∞|–≥—Ä—É–¥–Ω—è)/i;
            const dateMatch = text.match(dateRegex);
            let dateStr = "–°–¨–û–ì–û–î–ù–Ü";
            if (dateMatch) dateStr = dateMatch[0].toUpperCase();
            
            // –í—Å—Ç–∞–≤–ª—è—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –∫–∞—Ä—Ç–∏–Ω–∫—É
            // –†–æ–∑–±–∏–≤–∞—î–º–æ, —â–æ–± –¥–∞—Ç–∞ –±—É–ª–∞ –Ω–∞ –Ω–æ–≤–æ–º—É —Ä—è–¥–∫—É, —è–∫—â–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–≤–≥–∏–π
            dateDisplay.innerHTML = `${selectedTitle}<br>–ù–ê ${dateStr}`;

            // –ü–∞—Ä—Å–∏–Ω–≥
            const regex = /(?:^|\n)\s*1\.2\s+([^\n]+)/;
            const match = text.match(regex);
            if (!match) { debug.textContent = "–ù–µ –±–∞—á—É 1.2 —É —Ç–µ–∫—Å—Ç—ñ!"; return; }

            hoursStatus.fill('on');
            let textIntervals = [];
            const ranges = match[1].trim().split(';');

            ranges.forEach(range => {
                range = range.trim();
                if (!range || !/\d/.test(range)) return;
                const parts = range.split(/[\-\‚Äì\‚Äî]/); 
                if (parts.length < 2) return;
                const startStr = parts[0].trim(); 
                const endStr = parts[1].trim();
                applyRange(parseTime(startStr), parseTime(endStr));
                textIntervals.push(`${getClockEmoji(startStr)} ${startStr}-${endStr}`);
            });

            renderAll();
            
            // –§–æ—Ä–º—É—î–º–æ —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è
            finalGeneratedText = `${selectedTitle} –ù–ê ${dateStr}\n\n${textIntervals.join('\n')}\n\n–•–∞—Ä–∫—ñ–≤–æ–±–ª–µ–Ω–µ—Ä–≥–æ`;
            finalTextDisplay.textContent = finalGeneratedText;
            
            // –°–∫–∏–¥–∞—î–º–æ —Å—Ç–∞–Ω –∫–Ω–æ–ø–∫–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è
            copyBlock.classList.remove('copied');

            // –ß–µ–∫–∞—î–º–æ —Ä–µ–Ω–¥–µ—Ä DOM, –ø–æ—Ç—ñ–º –º–∞–ª—é—î–º–æ –∫–∞–Ω–≤–∞—Å
            setTimeout(generateImageOutput, 200); 
            outputContainer.style.display = 'block';
        }

        function parseTime(t) { 
            const cleaned = t.replace(/[^\d:]/g, '');
            const parts = cleaned.split(':');
            return { h: parseInt(parts[0]) || 0, m: parts.length > 1 ? parseInt(parts[1]) : 0 }; 
        }

        function getClockEmoji(t) { 
            let h = parseInt(t.split(':')[0]); 
            return isNaN(h) ? 'üïí' : clocks[h % 12]; 
        }
        
        function applyRange(start, end) {
            let s = start.h * 60 + start.m;
            let e = end.h * 60 + end.m;
            if (e === 0 && end.h === 0) e = 1440;
            if (e < s) e = 1440;
            
            for (let h = 0; h < 24; h++) {
                let hs = h * 60;
                let he = (h + 1) * 60;
                if (hs >= s && he <= e) hoursStatus[h] = 'off';
                else if (s > hs && s < he) hoursStatus[h] = start.m >= 30 ? 'start-half' : 'off';
                else if (e > hs && e < he) hoursStatus[h] = end.m >= 30 ? 'end-half' : 'on';
            }
        }

        function clearAll() {
            document.getElementById('rawText').value = '';
            hoursStatus.fill('on');
            renderAll();
            outputContainer.style.display = 'none';
            dateDisplay.innerHTML = '–ì–†–ê–§–Ü–ö<br>–í–Ü–î–ö–õ–Æ–ß–ï–ù–¨';
        }

        // === COPY LOGIC ===
        function copyTextToClipboard() {
            if (!finalGeneratedText) return;
            navigator.clipboard.writeText(finalGeneratedText).then(() => {
                copyBlock.classList.add('copied');
                // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫ –∑–Ω—è—Ç–∏ –∫–ª–∞—Å
                setTimeout(() => copyBlock.classList.remove('copied'), 2000);
            }).catch(err => {
                alert("–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è: " + err);
            });
        }

        // === IMAGE SAVING LOGIC ===
        function generateImageOutput() {
            html2canvas(captureTarget, {
                scale: 3, 
                backgroundColor: null, // –ü—Ä–æ–∑–æ—Ä–∏–π, –±–µ—Ä–µ–º–æ –∑ CSS
                logging: false,
                useCORS: true
            }).then(canvas => {
                // –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–µ–≤'—é
                generatedImage.src = canvas.toDataURL('image/png');
                
                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ canvas –≥–ª–æ–±–∞–ª—å–Ω–æ –∞–±–æ –≤ –∑–º—ñ–Ω–Ω—É, —â–æ–± –ø–æ—Ç—ñ–º —Å–∫–∞—á–∞—Ç–∏
                window.lastGeneratedCanvas = canvas;
            });
        }

        function downloadImage() {
            if (!window.lastGeneratedCanvas) {
                alert("–°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π –≥—Ä–∞—Ñ—ñ–∫!");
                return;
            }
            const link = document.createElement('a');
            link.download = `grafik_${Date.now()}.png`;
            link.href = window.lastGeneratedCanvas.toDataURL('image/png');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        window.addEventListener('resize', renderAll);
        initGrid();
    </script>
</body>
</html>
